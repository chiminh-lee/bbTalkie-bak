<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP-NOW RSSIä¸ä¸¢åŒ…ç‡åˆ†æ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .info-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .info-box h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .info-box .value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .info-box .detail {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f5f5f5;
        }
        
        .status-excellent { color: #4caf50; font-weight: bold; }
        .status-good { color: #8bc34a; font-weight: bold; }
        .status-fair { color: #ff9800; font-weight: bold; }
        .status-poor { color: #f44336; font-weight: bold; }
        .status-unusable { color: #d32f2f; font-weight: bold; }
        
        .formula {
            background: #f5f5f5;
            padding: 15px;
            border-left: 4px solid #667eea;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }
        
        .conclusion {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #4caf50;
        }
        
        .conclusion h3 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        ul {
            margin-left: 20px;
            line-height: 1.8;
        }
        
        .interactive-section {
            margin: 20px 0;
        }
        
        .slider-container {
            margin: 20px 0;
        }
        
        .slider-container label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }
        
        .slider-value {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            margin-left: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¡ ESP-NOW RSSIä¸ä¸¢åŒ…ç‡æ·±åº¦åˆ†æ</h1>
        
        <div class="card">
            <h2>ğŸ“Š RSSI vs ä¸¢åŒ…ç‡å…³ç³»å›¾ï¼ˆä¸åŒåŒ…å¤§å°ï¼‰</h2>
            <div class="chart-container">
                <canvas id="rssiChart"></canvas>
            </div>
        </div>
        
        <div class="card">
            <h2>ğŸ¯ å…³é”®æ•°æ®è¡¨æ ¼</h2>
            <table>
                <thead>
                    <tr>
                        <th>RSSI (dBm)</th>
                        <th>ä¿¡å·è´¨é‡</th>
                        <th>128Bä¸¢åŒ…ç‡</th>
                        <th>256Bä¸¢åŒ…ç‡</th>
                        <th>512Bä¸¢åŒ…ç‡</th>
                        <th>çŠ¶æ€è¯„ä¼°</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>-30 ~ -50</td>
                        <td><span class="status-excellent">ä¼˜ç§€</span></td>
                        <td>&lt;0.1%</td>
                        <td>&lt;0.1%</td>
                        <td>&lt;0.5%</td>
                        <td>å®Œç¾ï¼ŒåŒ…å¤§å°å½±å“æå°</td>
                    </tr>
                    <tr>
                        <td>-50 ~ -60</td>
                        <td><span class="status-excellent">ä¼˜ç§€</span></td>
                        <td>&lt;0.5%</td>
                        <td>&lt;1%</td>
                        <td>1-2%</td>
                        <td>å¾ˆå¥½ï¼Œå¤§åŒ…ç•¥æœ‰åŠ£åŠ¿</td>
                    </tr>
                    <tr>
                        <td>-60 ~ -70</td>
                        <td><span class="status-good">è‰¯å¥½</span></td>
                        <td>1-2%</td>
                        <td>2-4%</td>
                        <td>5-8%</td>
                        <td>å¯ç”¨ï¼Œå¤§åŒ…åŠ£åŠ¿æ˜æ˜¾</td>
                    </tr>
                    <tr>
                        <td>-70 ~ -75</td>
                        <td><span class="status-fair">ä¸€èˆ¬</span></td>
                        <td>3-5%</td>
                        <td>5-10%</td>
                        <td>10-15%</td>
                        <td>å‹‰å¼ºå¯ç”¨ï¼Œéœ€ä¼˜åŒ–</td>
                    </tr>
                    <tr>
                        <td>-75 ~ -80</td>
                        <td><span class="status-poor">å·®</span></td>
                        <td>8-15%</td>
                        <td>15-25%</td>
                        <td>25-40%</td>
                        <td>ä½“éªŒå¾ˆå·®ï¼Œä¸¥é‡ä¸¢åŒ…</td>
                    </tr>
                    <tr>
                        <td>-80 ~ -85</td>
                        <td><span class="status-poor">å¾ˆå·®</span></td>
                        <td>15-30%</td>
                        <td>30-50%</td>
                        <td>50-70%</td>
                        <td>å‡ ä¹ä¸å¯ç”¨</td>
                    </tr>
                    <tr>
                        <td>&lt; -85</td>
                        <td><span class="status-unusable">ä¸å¯ç”¨</span></td>
                        <td>&gt;40%</td>
                        <td>&gt;60%</td>
                        <td>&gt;80%</td>
                        <td>æ— æ³•é€šä¿¡</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="info-grid">
            <div class="info-box">
                <h3>ğŸ¯ æœ€ä½³å·¥ä½œèŒƒå›´</h3>
                <div class="value">-30 ~ -70 dBm</div>
                <div class="detail">ä¸¢åŒ…ç‡ &lt; 5%<br>ç”¨æˆ·ä½“éªŒè‰¯å¥½</div>
            </div>
            <div class="info-box">
                <h3>âš ï¸ ä¸´ç•ŒèŒƒå›´</h3>
                <div class="value">-70 ~ -80 dBm</div>
                <div class="detail">ä½ çš„åœºæ™¯åœ¨è¿™é‡Œ<br>éœ€è¦ä¼˜åŒ–</div>
            </div>
            <div class="info-box">
                <h3>âŒ ä¸å¯ç”¨èŒƒå›´</h3>
                <div class="value">&lt; -85 dBm</div>
                <div class="detail">ä¸¢åŒ…ç‡ &gt; 50%<br>æ— æ³•æ­£å¸¸é€šä¿¡</div>
            </div>
        </div>
        
        <div class="card">
            <h2>ğŸ”¬ æ ¸å¿ƒåŸç†è§£æ</h2>
            
            <h3>1ï¸âƒ£ ä¸ºä»€ä¹ˆå¤§åŒ…æ›´å®¹æ˜“ä¸¢ï¼Ÿ</h3>
            <div class="formula">
                <strong>è¯¯ç ç‡ï¼ˆBERï¼‰</strong> = å›ºå®šå€¼ï¼ˆå–å†³äºRSSIï¼‰<br>
                <strong>åŒ…é”™è¯¯ç‡ï¼ˆPERï¼‰</strong> = 1 - (1 - BER)^åŒ…å¤§å°ï¼ˆbitsï¼‰
            </div>
            
            <div class="highlight">
                <strong>ç®€åŒ–ç†è§£ï¼š</strong><br>
                â€¢ å‡è®¾æ¯ä¸ªbitæœ‰0.001%çš„é”™è¯¯æ¦‚ç‡ï¼ˆBERï¼‰<br>
                â€¢ 128å­—èŠ‚ = 1024 bits â†’ é”™è¯¯æ¦‚ç‡ â‰ˆ 1%<br>
                â€¢ 512å­—èŠ‚ = 4096 bits â†’ é”™è¯¯æ¦‚ç‡ â‰ˆ 4%<br>
                <br>
                <strong>ç»“è®ºï¼šåŒ…è¶Šå¤§ï¼ŒåŒ…å«é”™è¯¯bitçš„æ¦‚ç‡è¶Šé«˜ï¼</strong>
            </div>
            
            <h3>2ï¸âƒ£ RSSIä¸è¯¯ç ç‡çš„å…³ç³»</h3>
            <div class="formula">
                ä¿¡å™ªæ¯”ï¼ˆSNRï¼‰â‰ˆ RSSI - å™ªå£°åº•ï¼ˆçº¦-95dBmï¼‰<br>
                è¯¯ç ç‡ï¼ˆBERï¼‰éšSNRæŒ‡æ•°çº§ä¸‹é™
            </div>
            
            <p style="margin: 15px 0; line-height: 1.6;">
                â€¢ <strong>-60 dBm</strong>: SNR â‰ˆ 35dB â†’ BER â‰ˆ 10^-8ï¼ˆå‡ ä¹æ— é”™è¯¯ï¼‰<br>
                â€¢ <strong>-70 dBm</strong>: SNR â‰ˆ 25dB â†’ BER â‰ˆ 10^-6ï¼ˆå¼€å§‹å½±å“ï¼‰<br>
                â€¢ <strong>-75 dBm</strong>: SNR â‰ˆ 20dB â†’ BER â‰ˆ 10^-5ï¼ˆæ˜æ˜¾ä¸¢åŒ…ï¼‰<br>
                â€¢ <strong>-80 dBm</strong>: SNR â‰ˆ 15dB â†’ BER â‰ˆ 10^-4ï¼ˆä¸¥é‡ä¸¢åŒ…ï¼‰<br>
                â€¢ <strong>-85 dBm</strong>: SNR â‰ˆ 10dB â†’ BER â‰ˆ 10^-3ï¼ˆä¸å¯ç”¨ï¼‰
            </p>
            
            <h3>3ï¸âƒ£ å®é™…ä¼ è¾“æ—¶é—´çš„å½±å“</h3>
            <table>
                <tr>
                    <th>åŒ…å¤§å°</th>
                    <th>ä¼ è¾“æ—¶é—´</th>
                    <th>å¹²æ‰°æš´éœ²æ—¶é—´</th>
                    <th>ç¢°æ’æ¦‚ç‡</th>
                </tr>
                <tr>
                    <td>128B</td>
                    <td>~0.3ms</td>
                    <td>çŸ­</td>
                    <td>ä½</td>
                </tr>
                <tr>
                    <td>256B</td>
                    <td>~0.6ms</td>
                    <td>ä¸­</td>
                    <td>ä¸­</td>
                </tr>
                <tr>
                    <td>512B</td>
                    <td>~1.2ms</td>
                    <td>é•¿</td>
                    <td>é«˜</td>
                </tr>
            </table>
            
            <p style="margin: 15px 0; line-height: 1.6;">
                <strong>ä¼ è¾“æ—¶é—´è¶Šé•¿ï¼š</strong><br>
                âœ— æ›´å®¹æ˜“é­é‡çªå‘å¹²æ‰°ï¼ˆå¦‚å¾®æ³¢ç‚‰ã€è“ç‰™è®¾å¤‡ï¼‰<br>
                âœ— æ›´å®¹æ˜“ä¸å…¶ä»–è®¾å¤‡ç¢°æ’<br>
                âœ— ä¿¡é“æ¡ä»¶å˜åŒ–çš„æ¦‚ç‡æ›´å¤§
            </p>
        </div>
        
        <div class="card">
            <h2>ğŸ§ª äº¤äº’å¼è®¡ç®—å™¨</h2>
            <div class="interactive-section">
                <div class="slider-container">
                    <label>
                        è°ƒæ•´RSSIå€¼: <span class="slider-value" id="rssiValue">-75 dBm</span>
                    </label>
                    <input type="range" id="rssiSlider" min="-95" max="-30" value="-75" step="1">
                </div>
                
                <div class="slider-container">
                    <label>
                        è°ƒæ•´åŒ…å¤§å°: <span class="slider-value" id="packetValue">256 å­—èŠ‚</span>
                    </label>
                    <input type="range" id="packetSlider" min="64" max="512" value="256" step="32">
                </div>
                
                <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">ğŸ“ˆ è®¡ç®—ç»“æœï¼š</h3>
                    <p style="font-size: 1.1em; line-height: 1.8;">
                        <strong>ä¿¡å™ªæ¯”ï¼ˆSNRï¼‰ï¼š</strong> <span id="snrResult">20 dB</span><br>
                        <strong>ä¼°ç®—ä¸¢åŒ…ç‡ï¼š</strong> <span id="perResult">10%</span><br>
                        <strong>çŠ¶æ€è¯„ä¼°ï¼š</strong> <span id="statusResult" class="status-fair">ä¸€èˆ¬</span><br>
                        <strong>å»ºè®®ï¼š</strong> <span id="suggestionResult">é™ä½åŒ…å¤§å°æˆ–æ”¹å–„ä¿¡å·</span>
                    </p>
                </div>
            </div>
        </div>
        
        <div class="conclusion">
            <h3>ğŸ’¡ æ ¸å¿ƒç»“è®º</h3>
            <ul>
                <li><strong>RSSI > -70 dBm</strong>ï¼šåŒ…å¤§å°å½±å“ä¸å¤§ï¼Œä¼˜å…ˆè€ƒè™‘å»¶è¿Ÿå’Œæ•ˆç‡</li>
                <li><strong>RSSI -70 ~ -80 dBm</strong>ï¼šå°åŒ…ä¼˜åŠ¿æ˜æ˜¾ï¼Œå»ºè®®128-256å­—èŠ‚</li>
                <li><strong>RSSI < -80 dBm</strong>ï¼šæ— è®ºåŒ…å¤šå°éƒ½å¾ˆéš¾ç”¨ï¼Œéœ€æ”¹å–„ç¡¬ä»¶</li>
                <li><strong>ä½ çš„-75 dBmåœºæ™¯</strong>ï¼š256å­—èŠ‚ä¼šæ¯”512å­—èŠ‚ä¸¢åŒ…ç‡é™ä½çº¦50%</li>
                <li><strong>å®ç”¨é˜ˆå€¼</strong>ï¼š-78 dBmæ˜¯è¯­éŸ³é€šä¿¡çš„æé™ï¼Œå†å·®å°±éœ€è¦ç¡¬ä»¶æ”¹è¿›</li>
            </ul>
        </div>
        
        <div class="card">
            <h2>ğŸ¯ é’ˆå¯¹ä½ çš„å…·ä½“å»ºè®®</h2>
            <div class="highlight">
                <h3>è½¯ä»¶ä¼˜åŒ–ï¼ˆç«‹å³å¯è¡Œï¼‰ï¼š</h3>
                <ul>
                    <li>âœ… å°†åŒ…å¤§å°ä»512é™åˆ°<strong>240-256å­—èŠ‚</strong></li>
                    <li>âœ… è°ƒæ•´å»¶è¿Ÿåˆ°<strong>12-15ms</strong></li>
                    <li>âœ… æ·»åŠ <strong>FECå‰å‘çº é”™</strong>ï¼ˆå‘é€å†—ä½™æ•°æ®ï¼‰</li>
                    <li>âœ… å®ç°<strong>ç®€å•é‡ä¼ æœºåˆ¶</strong>ï¼ˆæ£€æµ‹è¿ç»­ä¸¢åŒ…æ—¶é‡å‘ï¼‰</li>
                    <li>é¢„æœŸæ•ˆæœï¼šä¸¢åŒ…ç‡ä»15%é™åˆ°8-10%</li>
                </ul>
                
                <h3 style="margin-top: 20px;">ç¡¬ä»¶æ”¹è¿›ï¼ˆæ ¹æœ¬è§£å†³ï¼‰ï¼š</h3>
                <ul>
                    <li>ğŸ”§ æ›´æ¢<strong>å¤–ç½®å¤©çº¿</strong>ï¼ˆ+5~8dBå¢ç›Šï¼‰</li>
                    <li>ğŸ”§ ä¼˜åŒ–PCBå¤©çº¿è®¾è®¡ï¼ˆæ”¹å–„é˜»æŠ—åŒ¹é…ï¼‰</li>
                    <li>ğŸ”§ ä½¿ç”¨é‡‘å±å¤–å£³è¦å¼€å¤©çº¿çª—å£</li>
                    <li>ğŸ”§ è€ƒè™‘<strong>PAåŠŸç‡æ”¾å¤§å™¨</strong>ï¼ˆéœ€ç¬¦åˆæ³•è§„ï¼‰</li>
                    <li>é¢„æœŸæ•ˆæœï¼šRSSIä»-75æå‡åˆ°-65 dBmï¼Œä¸¢åŒ…ç‡<5%</li>
                </ul>
            </div>
        </div>
    </div>
    
    <script>
        // RSSI vs Packet Loss Chart
        const ctx = document.getElementById('rssiChart').getContext('2d');
        const rssiChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [-30, -40, -50, -60, -65, -70, -75, -80, -85, -90],
                datasets: [
                    {
                        label: '128å­—èŠ‚',
                        data: [0.05, 0.1, 0.2, 0.5, 1, 2, 4, 10, 25, 50],
                        borderColor: '#4caf50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4,
                        borderWidth: 3
                    },
                    {
                        label: '256å­—èŠ‚',
                        data: [0.1, 0.2, 0.5, 1, 2, 4, 8, 18, 40, 65],
                        borderColor: '#2196f3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        tension: 0.4,
                        borderWidth: 3
                    },
                    {
                        label: '512å­—èŠ‚',
                        data: [0.2, 0.5, 1, 2, 5, 8, 15, 30, 55, 80],
                        borderColor: '#f44336',
                        backgroundColor: 'rgba(244, 67, 54, 0.1)',
                        tension: 0.4,
                        borderWidth: 3
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            font: { size: 14, weight: 'bold' },
                            padding: 15
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.parsed.y.toFixed(1) + '%';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'RSSI (dBm)',
                            font: { size: 14, weight: 'bold' }
                        },
                        grid: { color: '#e0e0e0' }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'ä¸¢åŒ…ç‡ (%)',
                            font: { size: 14, weight: 'bold' }
                        },
                        beginAtZero: true,
                        max: 90,
                        grid: { color: '#e0e0e0' }
                    }
                }
            }
        });
        
        // Interactive calculator
        const rssiSlider = document.getElementById('rssiSlider');
        const packetSlider = document.getElementById('packetSlider');
        const rssiValue = document.getElementById('rssiValue');
        const packetValue = document.getElementById('packetValue');
        const snrResult = document.getElementById('snrResult');
        const perResult = document.getElementById('perResult');
        const statusResult = document.getElementById('statusResult');
        const suggestionResult = document.getElementById('suggestionResult');
        
        function calculatePER(rssi, packetSize) {
            const noiseFloor = -95;
            const snr = rssi - noiseFloor;
            
            // Simplified BER calculation (exponential model)
            let ber;
            if (snr > 30) ber = 1e-9;
            else if (snr > 25) ber = 1e-7;
            else if (snr > 20) ber = 5e-6;
            else if (snr > 15) ber = 5e-5;
            else if (snr > 10) ber = 5e-4;
            else ber = 1e-2;
            
            // PER = 1 - (1-BER)^bits
            const bits = packetSize * 8;
            const per = (1 - Math.pow(1 - ber, bits)) * 100;
            
            return { snr, per };
        }
        
        function updateCalculator() {
            const rssi = parseInt(rssiSlider.value);
            const packetSize = parseInt(packetSlider.value);
            
            rssiValue.textContent = rssi + ' dBm';
            packetValue.textContent = packetSize + ' å­—èŠ‚';
            
            const result = calculatePER(rssi, packetSize);
            snrResult.textContent = result.snr.toFixed(1) + ' dB';
            perResult.textContent = result.per.toFixed(1) + '%';
            
            // Status and suggestion
            let status, statusClass, suggestion;
            if (result.per < 2) {
                status = 'ä¼˜ç§€';
                statusClass = 'status-excellent';
                suggestion = 'ä¿¡å·è‰¯å¥½ï¼Œå¯ä»¥ä½¿ç”¨å¤§åŒ…æé«˜æ•ˆç‡';
            } else if (result.per < 5) {
                status = 'è‰¯å¥½';
                statusClass = 'status-good';
                suggestion = 'ä¿¡å·ä¸é”™ï¼Œå½“å‰é…ç½®åˆé€‚';
            } else if (result.per < 15) {
                status = 'ä¸€èˆ¬';
                statusClass = 'status-fair';
                suggestion = 'å»ºè®®é™ä½åŒ…å¤§å°åˆ°128-256å­—èŠ‚';
            } else if (result.per < 40) {
                status = 'å·®';
                statusClass = 'status-poor';
                suggestion = 'éœ€è¦æ”¹å–„ä¿¡å·æˆ–ä½¿ç”¨æœ€å°åŒ…ï¼ˆ128å­—èŠ‚ï¼‰';
            } else {
                status = 'ä¸å¯ç”¨';
                statusClass = 'status-unusable';
                suggestion = 'æ— æ³•æ­£å¸¸é€šä¿¡ï¼Œå¿…é¡»æ”¹å–„ç¡¬ä»¶';
            }
            
            statusResult.textContent = status;
            statusResult.className = statusClass;
            suggestionResult.textContent = suggestion;
        }
        
        rssiSlider.addEventListener('input', updateCalculator);
        packetSlider.addEventListener('input', updateCalculator);
        
        // Initialize
        updateCalculator();
    </script>
</body>
</html>